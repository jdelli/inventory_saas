# HR Management System Setup Guide

This guide will help you set up the HR management system with Supabase integration for your Flutter inventory SaaS application.

## Prerequisites

1. Flutter SDK installed
2. Supabase account and project created
3. Your environment variables configured

## Environment Variables

Make sure you have the following environment variables set in your system:

```bash
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE=your_supabase_service_role_key
```

## Setup Steps

### 1. Install Dependencies

Run the following command to install the required dependencies:

```bash
flutter pub get
```

### 2. Database Setup

1. Go to your Supabase project dashboard
2. Navigate to the SQL Editor
3. Copy and paste the contents of `database_schema.sql` into the editor
4. Execute the SQL script to create the employees table and sample data

### 3. Configure Row Level Security (RLS)

The SQL script includes RLS policies, but you may need to adjust them based on your authentication setup:

- If you're using Supabase Auth, the policies are already configured
- If you're using a different auth system, you may need to modify the policies

### 4. Test the Setup

1. Run your Flutter application
2. Navigate to the HR Management page
3. Verify that you can see the sample employee data
4. Test the search and filter functionality

## Available Queries

The HR service provides the following Supabase queries:

### Basic CRUD Operations
- `getAllEmployees()` - Fetch all employees
- `getEmployeeById(String id)` - Get employee by ID
- `createEmployee(Employee employee)` - Create new employee
- `updateEmployee(Employee employee)` - Update existing employee
- `deleteEmployee(String id)` - Delete employee

### Advanced Queries
- `searchEmployees(String query)` - Search employees by name, email, or ID
- `getEmployeesByDepartment(String department)` - Filter by department
- `getEmployeesByStatus(String status)` - Filter by status
- `getEmployeesByHireDateRange(DateTime startDate, DateTime endDate)` - Filter by hire date range
- `getManagers()` - Get all managers
- `getEmployeesWithManagers()` - Get employees with their manager information
- `terminateEmployee(String id, DateTime terminationDate)` - Terminate an employee
- `getEmployeeStatistics()` - Get comprehensive employee statistics
- `bulkUpdateEmployees(List<Employee> employees)` - Bulk update multiple employees

### Statistics Queries
- Total employee count
- Active employee count
- Average salary calculation
- Department distribution
- Salary statistics

## Usage Examples

### Loading Employees
```dart
final hrProvider = context.read<HRProvider>();
await hrProvider.loadEmployees();
```

### Searching Employees
```dart
await hrProvider.searchEmployees('John');
```

### Creating an Employee
```dart
final newEmployee = Employee(
  id: '', // Will be generated by Supabase
  firstName: 'John',
  lastName: 'Doe',
  email: 'john.doe@company.com',
  phone: '+1234567890',
  department: 'Engineering',
  position: 'Software Engineer',
  employeeId: 'EMP001',
  hireDate: DateTime.now(),
  salary: 75000.0,
  status: 'active',
  createdAt: DateTime.now(),
  updatedAt: DateTime.now(),
);

await hrProvider.createEmployee(newEmployee);
```

### Filtering Employees
```dart
// Filter by department
hrProvider.filterByDepartment('Engineering');

// Filter by status
hrProvider.filterByStatus('active');

// Clear filters
hrProvider.clearFilters();
```

## Database Schema

The employees table includes the following fields:

- `id` (UUID) - Primary key
- `first_name` (VARCHAR) - Employee's first name
- `last_name` (VARCHAR) - Employee's last name
- `email` (VARCHAR) - Unique email address
- `phone` (VARCHAR) - Phone number
- `department` (VARCHAR) - Department name
- `position` (VARCHAR) - Job position
- `employee_id` (VARCHAR) - Unique employee ID
- `hire_date` (DATE) - Date of hire
- `salary` (DECIMAL) - Annual salary
- `status` (VARCHAR) - Employee status (active, inactive, terminated)
- `manager_id` (UUID) - Reference to manager
- `termination_date` (DATE) - Date of termination
- `address` (TEXT) - Employee address
- `emergency_contact` (VARCHAR) - Emergency contact name
- `emergency_phone` (VARCHAR) - Emergency contact phone
- `created_at` (TIMESTAMP) - Record creation time
- `updated_at` (TIMESTAMP) - Record update time

## Performance Optimizations

The database includes several indexes for better query performance:

- Department index
- Status index
- Hire date index
- Manager ID index
- Email index
- Employee ID index

## Security Features

- Row Level Security (RLS) enabled
- Authentication-based access control
- Input validation and sanitization
- Prepared statements for all queries

## Troubleshooting

### Common Issues

1. **Connection Error**: Verify your Supabase URL and API keys
2. **Permission Denied**: Check your RLS policies
3. **No Data**: Ensure the database schema has been created
4. **Search Not Working**: Verify the search query syntax

### Debug Mode

To enable debug mode for Supabase, modify the `SupabaseConfig.initialize()` method:

```dart
await Supabase.initialize(
  url: supabaseUrl,
  anonKey: supabaseAnonKey,
  debug: true, // Enable debug mode
);
```

## Next Steps

1. Implement employee forms for adding/editing
2. Add file upload for employee photos
3. Implement reporting and analytics
4. Add email notifications
5. Create employee onboarding workflows

## Support

If you encounter any issues, please check:
1. Supabase documentation
2. Flutter Supabase package documentation
3. Your network connectivity
4. Environment variable configuration
